<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="generator" content="Pelican" />
        <title>Pykafe Timor - github</title>
        <link rel="stylesheet" href="https://joshbrooks.github.io/theme/css/main.css" />
        <link href="https://joshbrooks.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Pykafe Timor Atom Feed" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://joshbrooks.github.io/">Pykafe Timor</a></h1>
                <nav><ul>
                    <li><a href="https://joshbrooks.github.io/category/python.html">Python</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="https://joshbrooks.github.io/using-github-actions.html">Using Github Actions</a></h1>
<footer class="post-info">
        <abbr class="published" title="2020-09-06T15:34:00+09:00">
                Published: Sun 06 September 2020
        </abbr>
		<br />
        <abbr class="modified" title="2020-09-06T15:34:00+09:00">
                Updated: Sun 06 September 2020
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://joshbrooks.github.io/author/joshua-brooks.html">Joshua Brooks</a>
        </address>
<p>In <a href="https://joshbrooks.github.io/category/python.html">Python</a>.</p>
<p>tags: <a href="https://joshbrooks.github.io/tag/github.html">github</a> <a href="https://joshbrooks.github.io/tag/actions.html">actions</a> </p>
</footer><!-- /.post-info --><h1>Git Actions</h1>
<p>Git Actions are a (relatively) new way of doing all sorts of interesting things with your code. Actions can run QA checks, tests, publish packages, create distributable files, and much much more. Actions are configured by adding <code>yaml</code> files into the <code>.github/workflows</code> directory of your repo</p>
<p>Some of the other interesting things you can do:
 - Install system packages and run command line tools
 - You can upload files generated by actions (eg whatver you built with <code>dist</code>) as an "artifact"
 - For testing: you can add any Docker images (postgres, redis etc) to your test run</p>
<p>Here's a simple example file:</p>
<div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Pytest</span>

<span class="nt">on</span><span class="p">:</span>
    <span class="nt">push</span><span class="p">:</span>
      <span class="nt">branches</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;tests/**&quot;</span>
    <span class="nt">pull_request</span><span class="p">:</span>
      <span class="nt">branches</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">master</span>

<span class="nt">jobs</span><span class="p">:</span>

    <span class="nt">flake8</span><span class="p">:</span>
        <span class="nt">runs-on</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>

        <span class="nt">steps</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">checkout</span>
          <span class="nt">uses</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">actions/checkout@v2</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Set up Python 3.8</span>
          <span class="nt">uses</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v2</span>
          <span class="nt">with</span><span class="p">:</span>
            <span class="nt">python-version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3.8</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
          <span class="nt">run</span><span class="p">:</span> <span class="p p-Indicator">|</span>
            <span class="no">pip install flake8</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">run flake8</span>
          <span class="nt">run</span><span class="p">:</span> <span class="p p-Indicator">|</span>
            <span class="no">python -m flake8</span>
</pre></div>


<p>This is going to run flake8 on every test run. We're checking out the repo, installing python and flake8, and running flake8. Super easy!</p>
<h2>Examples of Steps</h2>
<p>Here's steps we can use to run steps to build out our src files - in this case <code>yarn</code></p>
<div class="highlight"><pre><span></span>        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">node</span>
          <span class="nt">uses</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">actions/setup-node@v2</span>
          <span class="nt">with</span><span class="p">:</span>
            <span class="nt">node-version</span><span class="p">:</span> <span class="s">&#39;14&#39;</span>

        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yarn  install</span>
          <span class="nt">run</span><span class="p">:</span> <span class="p p-Indicator">|</span>
            <span class="no">npm install -g yarn</span>
            <span class="no">yarn install</span>
            <span class="no">yarn build</span>
</pre></div>


<p>Of course we usually want to install some system packages, which we can do with <code>apt</code> on ubuntu</p>
<div class="highlight"><pre><span></span>        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install OS level dependencies</span>
          <span class="nt">run</span><span class="p">:</span> <span class="p p-Indicator">|</span>
            <span class="no">sudo apt-get update</span>
            <span class="no">sudo apt-get install binutils libproj-dev gdal-bin python3-psycopg2</span>
</pre></div>


<p>To run prettier, we can use a contributed action. For this action, it's got options to push changes back into the repo if we include an appropriate TOKEN.</p>
<div class="highlight"><pre><span></span>        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Prettify code</span>
            <span class="l l-Scalar l-Scalar-Plain">uses</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">creyD/prettier_action@v3.1</span>
            <span class="l l-Scalar l-Scalar-Plain">with</span><span class="p p-Indicator">:</span>
                <span class="nt">prettier_options</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">--write src/ !src/tinymce/**</span>
          <span class=" -Error">  </span><span class="nt">env</span><span class="p">:</span>
                <span class="nt">GITHUB_TOKEN</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">${{ secrets.GITHUB_TOKEN }}</span>
</pre></div>                </article>
            </aside><!-- /#featured -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://joshbrooks.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>